
define("tinymce/dom/ScriptLoader",["tinymce/dom/DOMUtils","tinymce/util/Tools"],function(DOMUtils,Tools){var DOM=DOMUtils.DOM;var each=Tools.each,grep=Tools.grep;function ScriptLoader(){var QUEUED=0,LOADING=1,LOADED=2,states={},queue=[],scriptLoadedCallbacks={},queueLoadedCallbacks=[],loading=0,undef;function loadScript(url,callback){var dom=DOM,elm,id;function done(){dom.remove(id);if(elm){elm.onreadystatechange=elm.onload=elm=null;}
callback();}
function error(){if(typeof(console)!=="undefined"&&console.log){console.log("Failed to load: "+url);}}
id=dom.uniqueId();elm=document.createElement('script');elm.id=id;elm.type='text/javascript';elm.src=url;if("onreadystatechange"in elm){elm.onreadystatechange=function(){if(/loaded|complete/.test(elm.readyState)){done();}};}else{elm.onload=done;}
elm.onerror=error;(document.getElementsByTagName('head')[0]||document.body).appendChild(elm);}
this.isDone=function(url){return states[url]==LOADED;};this.markDone=function(url){states[url]=LOADED;};this.add=this.load=function(url,callback,scope){var state=states[url];if(state==undef){queue.push(url);states[url]=QUEUED;}
if(callback){if(!scriptLoadedCallbacks[url]){scriptLoadedCallbacks[url]=[];}
scriptLoadedCallbacks[url].push({func:callback,scope:scope||this});}};this.loadQueue=function(callback,scope){this.loadScripts(queue,callback,scope);};this.loadScripts=function(scripts,callback,scope){var loadScripts;function execScriptLoadedCallbacks(url){each(scriptLoadedCallbacks[url],function(callback){callback.func.call(callback.scope);});scriptLoadedCallbacks[url]=undef;}
queueLoadedCallbacks.push({func:callback,scope:scope||this});loadScripts=function(){var loadingScripts=grep(scripts);scripts.length=0;each(loadingScripts,function(url){if(states[url]==LOADED){execScriptLoadedCallbacks(url);return;}
if(states[url]!=LOADING){states[url]=LOADING;loading++;loadScript(url,function(){states[url]=LOADED;loading--;execScriptLoadedCallbacks(url);loadScripts();});}});if(!loading){each(queueLoadedCallbacks,function(callback){callback.func.call(callback.scope);});queueLoadedCallbacks.length=0;}};loadScripts();};}
ScriptLoader.ScriptLoader=new ScriptLoader();return ScriptLoader;});