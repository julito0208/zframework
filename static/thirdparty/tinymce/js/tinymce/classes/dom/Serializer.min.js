
define("tinymce/dom/Serializer",["tinymce/dom/DOMUtils","tinymce/html/DomParser","tinymce/html/Entities","tinymce/html/Serializer","tinymce/html/Node","tinymce/html/Schema","tinymce/Env","tinymce/util/Tools"],function(DOMUtils,DomParser,Entities,Serializer,Node,Schema,Env,Tools){var each=Tools.each,trim=Tools.trim;var DOM=DOMUtils.DOM;return function(settings,editor){var dom,schema,htmlParser;if(editor){dom=editor.dom;schema=editor.schema;}
dom=dom||DOM;schema=schema||new Schema(settings);settings.entity_encoding=settings.entity_encoding||'named';settings.remove_trailing_brs="remove_trailing_brs"in settings?settings.remove_trailing_brs:true;htmlParser=new DomParser(settings,schema);htmlParser.addAttributeFilter('data-mce-tabindex',function(nodes,name){var i=nodes.length,node;while(i--){node=nodes[i];node.attr('tabindex',node.attributes.map['data-mce-tabindex']);node.attr(name,null);}});htmlParser.addAttributeFilter('src,href,style',function(nodes,name){var i=nodes.length,node,value,internalName='data-mce-'+name;var urlConverter=settings.url_converter,urlConverterScope=settings.url_converter_scope,undef;while(i--){node=nodes[i];value=node.attributes.map[internalName];if(value!==undef){node.attr(name,value.length>0?value:null);node.attr(internalName,null);}else{value=node.attributes.map[name];if(name==="style"){value=dom.serializeStyle(dom.parseStyle(value),node.name);}else if(urlConverter){value=urlConverter.call(urlConverterScope,value,name,node.name);}
node.attr(name,value.length>0?value:null);}}});htmlParser.addAttributeFilter('class',function(nodes){var i=nodes.length,node,value;while(i--){node=nodes[i];value=node.attr('class');if(value){value=node.attr('class').replace(/(?:^|\s)mce-item-\w+(?!\S)/g,'');node.attr('class',value.length>0?value:null);}}});htmlParser.addAttributeFilter('data-mce-type',function(nodes,name,args){var i=nodes.length,node;while(i--){node=nodes[i];if(node.attributes.map['data-mce-type']==='bookmark'&&!args.cleanup){node.remove();}}});htmlParser.addNodeFilter('noscript',function(nodes){var i=nodes.length,node;while(i--){node=nodes[i].firstChild;if(node){node.value=Entities.decode(node.value);}}});htmlParser.addNodeFilter('script,style',function(nodes,name){var i=nodes.length,node,value,type;function trim(value){return value.replace(/(<!--\[CDATA\[|\]\]-->)/g,'\n').replace(/^[\r\n]*|[\r\n]*$/g,'').replace(/^\s*((<!--)?(\s*\/\/)?\s*<!\[CDATA\[|(<!--\s*)?\/\*\s*<!\[CDATA\[\s*\*\/|(\/\/)?\s*<!--|\/\*\s*<!--\s*\*\/)\s*[\r\n]*/gi,'').replace(/\s*(\/\*\s*\]\]>\s*\*\/(-->)?|\s*\/\/\s*\]\]>(-->)?|\/\/\s*(-->)?|\]\]>|\/\*\s*-->\s*\*\/|\s*-->\s*)\s*$/g,'');}
while(i--){node=nodes[i];value=node.firstChild?node.firstChild.value:'';if(name==="script"){type=node.attr('type');if(type){node.attr('type',type=='mce-no/type'?null:type.replace(/^mce\-/,''));}
if(value.length>0){node.firstChild.value='// <![CDATA[\n'+trim(value)+'\n// ]]>';}}else{if(value.length>0){node.firstChild.value='<!--\n'+trim(value)+'\n-->';}}}});htmlParser.addNodeFilter('#comment',function(nodes){var i=nodes.length,node;while(i--){node=nodes[i];if(node.value.indexOf('[CDATA[')===0){node.name='#cdata';node.type=4;node.value=node.value.replace(/^\[CDATA\[|\]\]$/g,'');}else if(node.value.indexOf('mce:protected ')===0){node.name="#text";node.type=3;node.raw=true;node.value=unescape(node.value).substr(14);}}});htmlParser.addNodeFilter('xml:namespace,input',function(nodes,name){var i=nodes.length,node;while(i--){node=nodes[i];if(node.type===7){node.remove();}else if(node.type===1){if(name==="input"&&!("type"in node.attributes.map)){node.attr('type','text');}}}});if(settings.fix_list_elements){htmlParser.addNodeFilter('ul,ol',function(nodes){var i=nodes.length,node,parentNode;while(i--){node=nodes[i];parentNode=node.parent;if(parentNode.name==='ul'||parentNode.name==='ol'){if(node.prev&&node.prev.name==='li'){node.prev.append(node);}}}});}
htmlParser.addAttributeFilter('data-mce-src,data-mce-href,data-mce-style,'+'data-mce-selected,data-mce-expando,'+'data-mce-type,data-mce-resize',function(nodes,name){var i=nodes.length;while(i--){nodes[i].attr(name,null);}});return{schema:schema,addNodeFilter:htmlParser.addNodeFilter,addAttributeFilter:htmlParser.addAttributeFilter,serialize:function(node,args){var self=this,impl,doc,oldDoc,htmlSerializer,content;if(Env.ie&&dom.select('script,style,select,map').length>0){content=node.innerHTML;node=node.cloneNode(false);dom.setHTML(node,content);}else{node=node.cloneNode(true);}
impl=node.ownerDocument.implementation;if(impl.createHTMLDocument){doc=impl.createHTMLDocument("");each(node.nodeName=='BODY'?node.childNodes:[node],function(node){doc.body.appendChild(doc.importNode(node,true));});if(node.nodeName!='BODY'){node=doc.body.firstChild;}else{node=doc.body;}
oldDoc=dom.doc;dom.doc=doc;}
args=args||{};args.format=args.format||'html';if(args.selection){args.forced_root_block='';}
if(!args.no_events){args.node=node;self.onPreProcess(args);}
htmlSerializer=new Serializer(settings,schema);args.content=htmlSerializer.serialize(htmlParser.parse(trim(args.getInner?node.innerHTML:dom.getOuterHTML(node)),args));if(!args.cleanup){args.content=args.content.replace(/\uFEFF/g,'');}
if(!args.no_events){self.onPostProcess(args);}
if(oldDoc){dom.doc=oldDoc;}
args.node=null;return args.content;},addRules:function(rules){schema.addValidElements(rules);},setRules:function(rules){schema.setValidElements(rules);},onPreProcess:function(args){if(editor){editor.fire('PreProcess',args);}},onPostProcess:function(args){if(editor){editor.fire('PostProcess',args);}}};};});