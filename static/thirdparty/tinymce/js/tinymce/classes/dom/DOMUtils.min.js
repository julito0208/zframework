
define("tinymce/dom/DOMUtils",["tinymce/dom/Sizzle","tinymce/dom/DomQuery","tinymce/html/Styles","tinymce/dom/EventUtils","tinymce/dom/TreeWalker","tinymce/dom/Range","tinymce/html/Entities","tinymce/Env","tinymce/util/Tools","tinymce/dom/StyleSheetLoader"],function(Sizzle,$,Styles,EventUtils,TreeWalker,Range,Entities,Env,Tools,StyleSheetLoader){var each=Tools.each,is=Tools.is,grep=Tools.grep,trim=Tools.trim;var isIE=Env.ie;var simpleSelectorRe=/^([a-z0-9],?)+$/i;var whiteSpaceRegExp=/^[ \t\r\n]*$/;function setupAttrHooks(domUtils,settings){var attrHooks={},keepValues=settings.keep_values,keepUrlHook;keepUrlHook={set:function($elm,value,name){if(settings.url_converter){value=settings.url_converter.call(settings.url_converter_scope||domUtils,value,name,$elm[0]);}
$elm.attr('data-mce-'+name,value).attr(name,value);},get:function($elm,name){return $elm.attr('data-mce-'+name)||$elm.attr(name);}};attrHooks={style:{set:function($elm,value){if(value!==null&&typeof value==='object'){$elm.css(value);return;}
if(keepValues){$elm.attr('data-mce-style',value);}
$elm.attr('style',value);},get:function($elm){var value=$elm.attr('data-mce-style')||$elm.attr('style');value=domUtils.serializeStyle(domUtils.parseStyle(value),$elm[0].nodeName);return value;}}};if(keepValues){attrHooks.href=attrHooks.src=keepUrlHook;}
return attrHooks;}
function DOMUtils(doc,settings){var self=this,blockElementsMap;self.doc=doc;self.win=window;self.files={};self.counter=0;self.stdMode=!isIE||doc.documentMode>=8;self.boxModel=!isIE||doc.compatMode=="CSS1Compat"||self.stdMode;self.styleSheetLoader=new StyleSheetLoader(doc);self.boundEvents=[];self.settings=settings=settings||{};self.schema=settings.schema;self.styles=new Styles({url_converter:settings.url_converter,url_converter_scope:settings.url_converter_scope},settings.schema);self.fixDoc(doc);self.events=settings.ownEvents?new EventUtils(settings.proxy):EventUtils.Event;self.attrHooks=setupAttrHooks(self,settings);blockElementsMap=settings.schema?settings.schema.getBlockElements():{};self.$=$.overrideDefaults(function(){return{context:doc,element:self.getRoot()};});self.isBlock=function(node){if(!node){return false;}
var type=node.nodeType;if(type){return!!(type===1&&blockElementsMap[node.nodeName]);}
return!!blockElementsMap[node];};}
DOMUtils.prototype={$$:function(elm){if(typeof elm=='string'){elm=this.get(elm);}
return this.$(elm);},root:null,fixDoc:function(doc){var settings=this.settings,name;if(isIE&&settings.schema){('abbr article aside audio canvas '+'details figcaption figure footer '+'header hgroup mark menu meter nav '+'output progress section summary '+'time video').replace(/\w+/g,function(name){doc.createElement(name);});for(name in settings.schema.getCustomElements()){doc.createElement(name);}}},clone:function(node,deep){var self=this,clone,doc;if(!isIE||node.nodeType!==1||deep){return node.cloneNode(deep);}
doc=self.doc;if(!deep){clone=doc.createElement(node.nodeName);each(self.getAttribs(node),function(attr){self.setAttrib(clone,attr.nodeName,self.getAttrib(node,attr.nodeName));});return clone;}
return clone.firstChild;},getRoot:function(){var self=this;return self.settings.root_element||self.doc.body;},getViewPort:function(win){var doc,rootElm;win=!win?this.win:win;doc=win.document;rootElm=this.boxModel?doc.documentElement:doc.body;return{x:win.pageXOffset||rootElm.scrollLeft,y:win.pageYOffset||rootElm.scrollTop,w:win.innerWidth||rootElm.clientWidth,h:win.innerHeight||rootElm.clientHeight};},getRect:function(elm){var self=this,pos,size;elm=self.get(elm);pos=self.getPos(elm);size=self.getSize(elm);return{x:pos.x,y:pos.y,w:size.w,h:size.h};},getSize:function(elm){var self=this,w,h;elm=self.get(elm);w=self.getStyle(elm,'width');h=self.getStyle(elm,'height');if(w.indexOf('px')===-1){w=0;}
if(h.indexOf('px')===-1){h=0;}
return{w:parseInt(w,10)||elm.offsetWidth||elm.clientWidth,h:parseInt(h,10)||elm.offsetHeight||elm.clientHeight};},getParent:function(node,selector,root){return this.getParents(node,selector,root,false);},getParents:function(node,selector,root,collect){var self=this,selectorVal,result=[];node=self.get(node);collect=collect===undefined;root=root||(self.getRoot().nodeName!='BODY'?self.getRoot().parentNode:null);if(is(selector,'string')){selectorVal=selector;if(selector==='*'){selector=function(node){return node.nodeType==1;};}else{selector=function(node){return self.is(node,selectorVal);};}}
while(node){if(node==root||!node.nodeType||node.nodeType===9){break;}
if(!selector||selector(node)){if(collect){result.push(node);}else{return node;}}
node=node.parentNode;}
return collect?result:null;},get:function(elm){var name;if(elm&&this.doc&&typeof(elm)=='string'){name=elm;elm=this.doc.getElementById(elm);if(elm&&elm.id!==name){return this.doc.getElementsByName(name)[1];}}
return elm;},getNext:function(node,selector){return this._findSib(node,selector,'nextSibling');},getPrev:function(node,selector){return this._findSib(node,selector,'previousSibling');},select:function(selector,scope){var self=this;return Sizzle(selector,self.get(scope)||self.settings.root_element||self.doc,[]);},is:function(elm,selector){var i;if(elm.length===undefined){if(selector==='*'){return elm.nodeType==1;}
if(simpleSelectorRe.test(selector)){selector=selector.toLowerCase().split(/,/);elm=elm.nodeName.toLowerCase();for(i=selector.length-1;i>=0;i--){if(selector[i]==elm){return true;}}
return false;}}
if(elm.nodeType&&elm.nodeType!=1){return false;}
var elms=elm.nodeType?[elm]:elm;return Sizzle(selector,elms[0].ownerDocument||elms[0],null,elms).length>0;},add:function(parentElm,name,attrs,html,create){var self=this;return this.run(parentElm,function(parentElm){var newElm;newElm=is(name,'string')?self.doc.createElement(name):name;self.setAttribs(newElm,attrs);if(html){if(html.nodeType){newElm.appendChild(html);}else{self.setHTML(newElm,html);}}
return!create?parentElm.appendChild(newElm):newElm;});},create:function(name,attrs,html){return this.add(this.doc.createElement(name),name,attrs,html,1);},createHTML:function(name,attrs,html){var outHtml='',key;outHtml+='<'+name;for(key in attrs){if(attrs.hasOwnProperty(key)&&attrs[key]!==null&&typeof attrs[key]!='undefined'){outHtml+=' '+key+'="'+this.encode(attrs[key])+'"';}}
if(typeof(html)!="undefined"){return outHtml+'>'+html+'</'+name+'>';}
return outHtml+' />';},createFragment:function(html){var frag,node,doc=this.doc,container;container=doc.createElement("div");frag=doc.createDocumentFragment();if(html){container.innerHTML=html;}
while((node=container.firstChild)){frag.appendChild(node);}
return frag;},remove:function(node,keepChildren){node=this.$$(node);if(keepChildren){node.each(function(){var child;while((child=this.firstChild)){if(child.nodeType==3&&child.data.length===0){this.removeChild(child);}else{this.parentNode.insertBefore(child,this);}}}).remove();}else{node.remove();}
return node.length>1?node.toArray():node[0];},setStyle:function(elm,name,value){elm=this.$$(elm).css(name,value);if(this.settings.update_styles){elm.attr('data-mce-style',null);}},getStyle:function(elm,name,computed){elm=this.$$(elm);if(computed){return elm.css(name);}
name=name.replace(/-(\D)/g,function(a,b){return b.toUpperCase();});if(name=='float'){name=isIE?'styleFloat':'cssFloat';}
return elm[0]&&elm[0].style?elm[0].style[name]:undefined;},setStyles:function(elm,styles){this.$$(elm).css(styles);},removeAllAttribs:function(e){return this.run(e,function(e){var i,attrs=e.attributes;for(i=attrs.length-1;i>=0;i--){e.removeAttributeNode(attrs.item(i));}});},setAttrib:function(elm,name,value){var self=this,originalValue,hook,settings=self.settings;if(value===''){value=null;}
elm=self.$$(elm);originalValue=elm.attr(name);if(!elm.length){return;}
hook=self.attrHooks[name];if(hook&&hook.set){hook.set(elm,value,name);}else{elm.attr(name,value);}
if(originalValue!=value&&settings.onSetAttrib){settings.onSetAttrib({attrElm:elm,attrName:name,attrValue:value});}},setAttribs:function(elm,attrs){var self=this;self.$$(elm).each(function(i,node){each(attrs,function(value,name){self.setAttrib(node,name,value);});});},getAttrib:function(elm,name,defaultVal){var self=this,hook,value;elm=self.$$(elm);if(elm.length){hook=self.attrHooks[name];if(hook&&hook.get){value=hook.get(elm,name);}else{value=elm.attr(name);}}
if(typeof value=='undefined'){value=defaultVal||'';}
return value;},getPos:function(elm,rootElm){var self=this,x=0,y=0,offsetParent,doc=self.doc,body=doc.body,pos;elm=self.get(elm);rootElm=rootElm||body;if(elm){if(rootElm===body&&elm.getBoundingClientRect&&$(body).css('position')==='static'){pos=elm.getBoundingClientRect();rootElm=self.boxModel?doc.documentElement:body;x=pos.left+(doc.documentElement.scrollLeft||body.scrollLeft)-rootElm.clientLeft;y=pos.top+(doc.documentElement.scrollTop||body.scrollTop)-rootElm.clientTop;return{x:x,y:y};}
offsetParent=elm;while(offsetParent&&offsetParent!=rootElm&&offsetParent.nodeType){x+=offsetParent.offsetLeft||0;y+=offsetParent.offsetTop||0;offsetParent=offsetParent.offsetParent;}
offsetParent=elm.parentNode;while(offsetParent&&offsetParent!=rootElm&&offsetParent.nodeType){x-=offsetParent.scrollLeft||0;y-=offsetParent.scrollTop||0;offsetParent=offsetParent.parentNode;}}
return{x:x,y:y};},parseStyle:function(cssText){return this.styles.parse(cssText);},serializeStyle:function(styles,name){return this.styles.serialize(styles,name);},addStyle:function(cssText){var self=this,doc=self.doc,head,styleElm;if(self!==DOMUtils.DOM&&doc===document){var addedStyles=DOMUtils.DOM.addedStyles;addedStyles=addedStyles||[];if(addedStyles[cssText]){return;}
addedStyles[cssText]=true;DOMUtils.DOM.addedStyles=addedStyles;}
styleElm=doc.getElementById('mceDefaultStyles');if(!styleElm){styleElm=doc.createElement('style');styleElm.id='mceDefaultStyles';styleElm.type='text/css';head=doc.getElementsByTagName('head')[0];if(head.firstChild){head.insertBefore(styleElm,head.firstChild);}else{head.appendChild(styleElm);}}
if(styleElm.styleSheet){styleElm.styleSheet.cssText+=cssText;}else{styleElm.appendChild(doc.createTextNode(cssText));}},loadCSS:function(url){var self=this,doc=self.doc,head;if(self!==DOMUtils.DOM&&doc===document){DOMUtils.DOM.loadCSS(url);return;}
if(!url){url='';}
head=doc.getElementsByTagName('head')[0];each(url.split(','),function(url){var link;if(self.files[url]){return;}
self.files[url]=true;link=self.create('link',{rel:'stylesheet',href:url});if(isIE&&doc.documentMode&&doc.recalc){link.onload=function(){if(doc.recalc){doc.recalc();}
link.onload=null;};}
head.appendChild(link);});},addClass:function(elm,cls){this.$$(elm).addClass(cls);},removeClass:function(elm,cls){this.toggleClass(elm,cls,false);},hasClass:function(elm,cls){return this.$$(elm).hasClass(cls);},toggleClass:function(elm,cls,state){this.$$(elm).toggleClass(cls,state).each(function(){if(this.className===''){$(this).attr('class',null);}});},show:function(elm){this.$$(elm).show();},hide:function(elm){this.$$(elm).hide();},isHidden:function(elm){return this.$$(elm).css('display')=='none';},uniqueId:function(prefix){return(!prefix?'mce_':prefix)+(this.counter++);},setHTML:function(elm,html){elm=this.$$(elm);if(isIE){elm.each(function(i,target){if(target.canHaveHTML===false){return;}
while(target.firstChild){target.removeChild(target.firstChild);}
try{target.innerHTML='<br>'+html;target.removeChild(target.firstChild);}catch(ex){$('<div>').html('<br>'+html).contents().slice(1).appendTo(target);}
return html;});}else{elm.html(html);}},getOuterHTML:function(elm){elm=this.get(elm);return elm.nodeType==1?elm.outerHTML:$('<div>').append($(elm).clone()).html();},setOuterHTML:function(elm,html){var self=this;self.$$(elm).each(function(){try{this.outerHTML=html;}catch(ex){self.remove($(this).html(html),true);}});},decode:Entities.decode,encode:Entities.encodeAllRaw,insertAfter:function(node,referenceNode){referenceNode=this.get(referenceNode);return this.run(node,function(node){var parent,nextSibling;parent=referenceNode.parentNode;nextSibling=referenceNode.nextSibling;if(nextSibling){parent.insertBefore(node,nextSibling);}else{parent.appendChild(node);}
return node;});},replace:function(newElm,oldElm,keepChildren){var self=this;return self.run(oldElm,function(oldElm){if(is(oldElm,'array')){newElm=newElm.cloneNode(true);}
if(keepChildren){each(grep(oldElm.childNodes),function(node){newElm.appendChild(node);});}
return oldElm.parentNode.replaceChild(newElm,oldElm);});},rename:function(elm,name){var self=this,newElm;if(elm.nodeName!=name.toUpperCase()){newElm=self.create(name);each(self.getAttribs(elm),function(attrNode){self.setAttrib(newElm,attrNode.nodeName,self.getAttrib(elm,attrNode.nodeName));});self.replace(newElm,elm,1);}
return newElm||elm;},findCommonAncestor:function(a,b){var ps=a,pe;while(ps){pe=b;while(pe&&ps!=pe){pe=pe.parentNode;}
if(ps==pe){break;}
ps=ps.parentNode;}
if(!ps&&a.ownerDocument){return a.ownerDocument.documentElement;}
return ps;},toHex:function(rgbVal){return this.styles.toHex(Tools.trim(rgbVal));},run:function(elm,func,scope){var self=this,result;if(typeof(elm)==='string'){elm=self.get(elm);}
if(!elm){return false;}
scope=scope||this;if(!elm.nodeType&&(elm.length||elm.length===0)){result=[];each(elm,function(elm,i){if(elm){if(typeof(elm)=='string'){elm=self.get(elm);}
result.push(func.call(scope,elm,i));}});return result;}
return func.call(scope,elm);},getAttribs:function(elm){var attrs;elm=this.get(elm);if(!elm){return[];}
if(isIE){attrs=[];if(elm.nodeName=='OBJECT'){return elm.attributes;}
if(elm.nodeName==='OPTION'&&this.getAttrib(elm,'selected')){attrs.push({specified:1,nodeName:'selected'});}
var attrRegExp=/<\/?[\w:\-]+ ?|=[\"][^\"]+\"|=\'[^\']+\'|=[\w\-]+|>/gi;elm.cloneNode(false).outerHTML.replace(attrRegExp,'').replace(/[\w:\-]+/gi,function(a){attrs.push({specified:1,nodeName:a});});return attrs;}
return elm.attributes;},isEmpty:function(node,elements){var self=this,i,attributes,type,walker,name,brCount=0;node=node.firstChild;if(node){walker=new TreeWalker(node,node.parentNode);elements=elements||self.schema?self.schema.getNonEmptyElements():null;do{type=node.nodeType;if(type===1){if(node.getAttribute('data-mce-bogus')){continue;}
name=node.nodeName.toLowerCase();if(elements&&elements[name]){if(name==='br'){brCount++;continue;}
return false;}
attributes=self.getAttribs(node);i=attributes.length;while(i--){name=attributes[i].nodeName;if(name==="name"||name==='data-mce-bookmark'){return false;}}}
if(type==8){return false;}
if((type===3&&!whiteSpaceRegExp.test(node.nodeValue))){return false;}}while((node=walker.next()));}
return brCount<=1;},createRng:function(){var doc=this.doc;return doc.createRange?doc.createRange():new Range(this);},nodeIndex:function(node,normalized){var idx=0,lastNodeType,nodeType;if(node){for(lastNodeType=node.nodeType,node=node.previousSibling;node;node=node.previousSibling){nodeType=node.nodeType;if(normalized&&nodeType==3){if(nodeType==lastNodeType||!node.nodeValue.length){continue;}}
idx++;lastNodeType=nodeType;}}
return idx;},split:function(parentElm,splitElm,replacementElm){var self=this,r=self.createRng(),bef,aft,pa;function trimNode(node){var i,children=node.childNodes,type=node.nodeType;function surroundedBySpans(node){var previousIsSpan=node.previousSibling&&node.previousSibling.nodeName=='SPAN';var nextIsSpan=node.nextSibling&&node.nextSibling.nodeName=='SPAN';return previousIsSpan&&nextIsSpan;}
if(type==1&&node.getAttribute('data-mce-type')=='bookmark'){return;}
for(i=children.length-1;i>=0;i--){trimNode(children[i]);}
if(type!=9){if(type==3&&node.nodeValue.length>0){var trimmedLength=trim(node.nodeValue).length;if(!self.isBlock(node.parentNode)||trimmedLength>0||trimmedLength===0&&surroundedBySpans(node)){return;}}else if(type==1){children=node.childNodes;if(children.length==1&&children[0]&&children[0].nodeType==1&&children[0].getAttribute('data-mce-type')=='bookmark'){node.parentNode.insertBefore(children[0],node);}
if(children.length||/^(br|hr|input|img)$/i.test(node.nodeName)){return;}}
self.remove(node);}
return node;}
if(parentElm&&splitElm){r.setStart(parentElm.parentNode,self.nodeIndex(parentElm));r.setEnd(splitElm.parentNode,self.nodeIndex(splitElm));bef=r.extractContents();r=self.createRng();r.setStart(splitElm.parentNode,self.nodeIndex(splitElm)+1);r.setEnd(parentElm.parentNode,self.nodeIndex(parentElm)+1);aft=r.extractContents();pa=parentElm.parentNode;pa.insertBefore(trimNode(bef),parentElm);if(replacementElm){pa.replaceChild(replacementElm,splitElm);}else{pa.insertBefore(splitElm,parentElm);}
pa.insertBefore(trimNode(aft),parentElm);self.remove(parentElm);return replacementElm||splitElm;}},bind:function(target,name,func,scope){var self=this;if(Tools.isArray(target)){var i=target.length;while(i--){target[i]=self.bind(target[i],name,func,scope);}
return target;}
if(self.settings.collect&&(target===self.doc||target===self.win)){self.boundEvents.push([target,name,func,scope]);}
return self.events.bind(target,name,func,scope||self);},unbind:function(target,name,func){var self=this,i;if(Tools.isArray(target)){i=target.length;while(i--){target[i]=self.unbind(target[i],name,func);}
return target;}
if(self.boundEvents&&(target===self.doc||target===self.win)){i=self.boundEvents.length;while(i--){var item=self.boundEvents[i];if(target==item[0]&&(!name||name==item[1])&&(!func||func==item[2])){this.events.unbind(item[0],item[1],item[2]);}}}
return this.events.unbind(target,name,func);},fire:function(target,name,evt){return this.events.fire(target,name,evt);},getContentEditable:function(node){var contentEditable;if(!node||node.nodeType!=1){return null;}
contentEditable=node.getAttribute("data-mce-contenteditable");if(contentEditable&&contentEditable!=="inherit"){return contentEditable;}
return node.contentEditable!=="inherit"?node.contentEditable:null;},getContentEditableParent:function(node){var root=this.getRoot(),state=null;for(;node&&node!==root;node=node.parentNode){state=this.getContentEditable(node);if(state!==null){break;}}
return state;},destroy:function(){var self=this;if(self.boundEvents){var i=self.boundEvents.length;while(i--){var item=self.boundEvents[i];this.events.unbind(item[0],item[1],item[2]);}
self.boundEvents=null;}
if(Sizzle.setDocument){Sizzle.setDocument();}
self.win=self.doc=self.root=self.events=self.frag=null;},isChildOf:function(node,parent){while(node){if(parent===node){return true;}
node=node.parentNode;}
return false;},dumpRng:function(r){return('startContainer: '+r.startContainer.nodeName+', startOffset: '+r.startOffset+', endContainer: '+r.endContainer.nodeName+', endOffset: '+r.endOffset);},_findSib:function(node,selector,name){var self=this,func=selector;if(node){if(typeof(func)=='string'){func=function(node){return self.is(node,selector);};}
for(node=node[name];node;node=node[name]){if(func(node)){return node;}}}
return null;}};DOMUtils.DOM=new DOMUtils(document);return DOMUtils;});