
define("tinymce/ui/Window",["tinymce/ui/FloatPanel","tinymce/ui/Panel","tinymce/ui/DomUtils","tinymce/ui/DragHelper"],function(FloatPanel,Panel,DomUtils,DragHelper){"use strict";var Window=FloatPanel.extend({modal:true,Defaults:{border:1,layout:'flex',containerCls:'panel',role:'dialog',callbacks:{submit:function(){this.fire('submit',{data:this.toJSON()});},close:function(){this.close();}}},init:function(settings){var self=this;self._super(settings);if(self.isRtl()){self.addClass('rtl');}
self.addClass('window');self._fixed=true;if(settings.buttons){self.statusbar=new Panel({layout:'flex',border:'1 0 0 0',spacing:3,padding:10,align:'center',pack:self.isRtl()?'start':'end',defaults:{type:'button'},items:settings.buttons});self.statusbar.addClass('foot');self.statusbar.parent(self);}
self.on('click',function(e){if(e.target.className.indexOf(self.classPrefix+'close')!=-1){self.close();}});self.on('cancel',function(){self.close();});self.aria('describedby',self.describedBy||self._id+'-none');self.aria('label',settings.title);self._fullscreen=false;},recalc:function(){var self=this,statusbar=self.statusbar,layoutRect,width,x,needsRecalc;if(self._fullscreen){self.layoutRect(DomUtils.getWindowSize());self.layoutRect().contentH=self.layoutRect().innerH;}
self._super();layoutRect=self.layoutRect();if(self.settings.title&&!self._fullscreen){width=layoutRect.headerW;if(width>layoutRect.w){x=layoutRect.x-Math.max(0,width/2);self.layoutRect({w:width,x:x});needsRecalc=true;}}
if(statusbar){statusbar.layoutRect({w:self.layoutRect().innerW}).recalc();width=statusbar.layoutRect().minW+layoutRect.deltaW;if(width>layoutRect.w){x=layoutRect.x-Math.max(0,width-layoutRect.w);self.layoutRect({w:width,x:x});needsRecalc=true;}}
if(needsRecalc){self.recalc();}},initLayoutRect:function(){var self=this,layoutRect=self._super(),deltaH=0,headEl;if(self.settings.title&&!self._fullscreen){headEl=self.getEl('head');var size=DomUtils.getSize(headEl);layoutRect.headerW=size.width;layoutRect.headerH=size.height;deltaH+=layoutRect.headerH;}
if(self.statusbar){deltaH+=self.statusbar.layoutRect().h;}
layoutRect.deltaH+=deltaH;layoutRect.minH+=deltaH;layoutRect.h+=deltaH;var rect=DomUtils.getWindowSize();layoutRect.x=Math.max(0,rect.w/2-layoutRect.w/2);layoutRect.y=Math.max(0,rect.h/2-layoutRect.h/2);return layoutRect;},renderHtml:function(){var self=this,layout=self._layout,id=self._id,prefix=self.classPrefix;var settings=self.settings,headerHtml='',footerHtml='',html=settings.html;self.preRender();layout.preRender(self);if(settings.title){headerHtml=('<div id="'+id+'-head" class="'+prefix+'window-head">'+'<div id="'+id+'-title" class="'+prefix+'title">'+self.encode(settings.title)+'</div>'+'<button type="button" class="'+prefix+'close" aria-hidden="true">\u00d7</button>'+'<div id="'+id+'-dragh" class="'+prefix+'dragh"></div>'+'</div>');}
if(settings.url){html='<iframe src="'+settings.url+'" tabindex="-1"></iframe>';}
if(typeof(html)=="undefined"){html=layout.renderHtml(self);}
if(self.statusbar){footerHtml=self.statusbar.renderHtml();}
return('<div id="'+id+'" class="'+self.classes()+'" hidefocus="1">'+'<div class="'+self.classPrefix+'reset" role="application">'+
headerHtml+'<div id="'+id+'-body" class="'+self.classes('body')+'">'+
html+'</div>'+
footerHtml+'</div>'+'</div>');},fullscreen:function(state){var self=this,documentElement=document.documentElement,slowRendering,prefix=self.classPrefix,layoutRect;if(state!=self._fullscreen){DomUtils.on(window,'resize',function(){var time;if(self._fullscreen){if(!slowRendering){time=new Date().getTime();var rect=DomUtils.getWindowSize();self.moveTo(0,0).resizeTo(rect.w,rect.h);if((new Date().getTime())-time>50){slowRendering=true;}}else{if(!self._timer){self._timer=setTimeout(function(){var rect=DomUtils.getWindowSize();self.moveTo(0,0).resizeTo(rect.w,rect.h);self._timer=0;},50);}}}});layoutRect=self.layoutRect();self._fullscreen=state;if(!state){self._borderBox=self.parseBox(self.settings.border);self.getEl('head').style.display='';layoutRect.deltaH+=layoutRect.headerH;DomUtils.removeClass(documentElement,prefix+'fullscreen');DomUtils.removeClass(document.body,prefix+'fullscreen');self.removeClass('fullscreen');self.moveTo(self._initial.x,self._initial.y).resizeTo(self._initial.w,self._initial.h);}else{self._initial={x:layoutRect.x,y:layoutRect.y,w:layoutRect.w,h:layoutRect.h};self._borderBox=self.parseBox('0');self.getEl('head').style.display='none';layoutRect.deltaH-=layoutRect.headerH+2;DomUtils.addClass(documentElement,prefix+'fullscreen');DomUtils.addClass(document.body,prefix+'fullscreen');self.addClass('fullscreen');var rect=DomUtils.getWindowSize();self.moveTo(0,0).resizeTo(rect.w,rect.h);}}
return self.reflow();},postRender:function(){var self=this,startPos;setTimeout(function(){self.addClass('in');},0);self._super();if(self.statusbar){self.statusbar.postRender();}
self.focus();this.dragHelper=new DragHelper(self._id+'-dragh',{start:function(){startPos={x:self.layoutRect().x,y:self.layoutRect().y};},drag:function(e){self.moveTo(startPos.x+e.deltaX,startPos.y+e.deltaY);}});self.on('submit',function(e){if(!e.isDefaultPrevented()){self.close();}});},submit:function(){return this.fire('submit',{data:this.toJSON()});},remove:function(){var self=this,prefix=self.classPrefix;self.dragHelper.destroy();self._super();if(self.statusbar){this.statusbar.remove();}
if(self._fullscreen){DomUtils.removeClass(document.documentElement,prefix+'fullscreen');DomUtils.removeClass(document.body,prefix+'fullscreen');}},getContentWindow:function(){var ifr=this.getEl().getElementsByTagName('iframe')[0];return ifr?ifr.contentWindow:null;}});return Window;});