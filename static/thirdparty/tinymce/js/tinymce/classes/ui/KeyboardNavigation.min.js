
define("tinymce/ui/KeyboardNavigation",[],function(){"use strict";return function(settings){var root=settings.root,focusedElement,focusedControl;try{focusedElement=document.activeElement;}catch(ex){focusedElement=document.body;}
focusedControl=root.getParentCtrl(focusedElement);function getRole(elm){elm=elm||focusedElement;return elm&&elm.getAttribute('role');}
function getParentRole(elm){var role,parent=elm||focusedElement;while((parent=parent.parentNode)){if((role=getRole(parent))){return role;}}}
function getAriaProp(name){var elm=focusedElement;if(elm){return elm.getAttribute('aria-'+name);}}
function isTextInputElement(elm){var tagName=elm.tagName.toUpperCase();return tagName=="INPUT"||tagName=="TEXTAREA";}
function canFocus(elm){if(isTextInputElement(elm)&&!elm.hidden){return true;}
if(/^(button|menuitem|checkbox|tab|menuitemcheckbox|option|gridcell)$/.test(getRole(elm))){return true;}
return false;}
function getFocusElements(elm){var elements=[];function collect(elm){if(elm.nodeType!=1||elm.style.display=='none'){return;}
if(canFocus(elm)){elements.push(elm);}
for(var i=0;i<elm.childNodes.length;i++){collect(elm.childNodes[i]);}}
collect(elm||root.getEl());return elements;}
function getNavigationRoot(targetControl){var navigationRoot,controls;targetControl=targetControl||focusedControl;controls=targetControl.parents().toArray();controls.unshift(targetControl);for(var i=0;i<controls.length;i++){navigationRoot=controls[i];if(navigationRoot.settings.ariaRoot){break;}}
return navigationRoot;}
function focusFirst(targetControl){var navigationRoot=getNavigationRoot(targetControl);var focusElements=getFocusElements(navigationRoot.getEl());if(navigationRoot.settings.ariaRemember&&"lastAriaIndex"in navigationRoot){moveFocusToIndex(navigationRoot.lastAriaIndex,focusElements);}else{moveFocusToIndex(0,focusElements);}}
function moveFocusToIndex(idx,elements){if(idx<0){idx=elements.length-1;}else if(idx>=elements.length){idx=0;}
if(elements[idx]){elements[idx].focus();}
return idx;}
function moveFocus(dir,elements){var idx=-1,navigationRoot=getNavigationRoot();elements=elements||getFocusElements(navigationRoot.getEl());for(var i=0;i<elements.length;i++){if(elements[i]===focusedElement){idx=i;}}
idx+=dir;navigationRoot.lastAriaIndex=moveFocusToIndex(idx,elements);}
function left(){var parentRole=getParentRole();if(parentRole=="tablist"){moveFocus(-1,getFocusElements(focusedElement.parentNode));}else if(focusedControl.parent().submenu){cancel();}else{moveFocus(-1);}}
function right(){var role=getRole(),parentRole=getParentRole();if(parentRole=="tablist"){moveFocus(1,getFocusElements(focusedElement.parentNode));}else if(role=="menuitem"&&parentRole=="menu"&&getAriaProp('haspopup')){enter();}else{moveFocus(1);}}
function up(){moveFocus(-1);}
function down(){var role=getRole(),parentRole=getParentRole();if(role=="menuitem"&&parentRole=="menubar"){enter();}else if(role=="button"&&getAriaProp('haspopup')){enter({key:'down'});}else{moveFocus(1);}}
function tab(e){var parentRole=getParentRole();if(parentRole=="tablist"){var elm=getFocusElements(focusedControl.getEl('body'))[0];if(elm){elm.focus();}}else{moveFocus(e.shiftKey?-1:1);}}
function cancel(){focusedControl.fire('cancel');}
function enter(aria){aria=aria||{};focusedControl.fire('click',{target:focusedElement,aria:aria});}
root.on('keydown',function(e){function handleNonTabOrEscEvent(e,handler){if(isTextInputElement(focusedElement)){return;}
if(handler(e)!==false){e.preventDefault();}}
if(e.isDefaultPrevented()){return;}
switch(e.keyCode){case 37:handleNonTabOrEscEvent(e,left);break;case 39:handleNonTabOrEscEvent(e,right);break;case 38:handleNonTabOrEscEvent(e,up);break;case 40:handleNonTabOrEscEvent(e,down);break;case 27:cancel();break;case 14:case 13:case 32:handleNonTabOrEscEvent(e,enter);break;case 9:if(tab(e)!==false){e.preventDefault();}
break;}});root.on('focusin',function(e){focusedElement=e.target;focusedControl=e.control;});return{focusFirst:focusFirst};};});