
define("tinymce/util/URI",["tinymce/util/Tools"],function(Tools){var each=Tools.each,trim=Tools.trim;var queryParts="source protocol authority userInfo user password host port relative path directory file query anchor".split(' ');var DEFAULT_PORTS={'ftp':21,'http':80,'https':443,'mailto':25};function URI(url,settings){var self=this,baseUri,base_url;url=trim(url);settings=self.settings=settings||{};baseUri=settings.base_uri;if(/^([\w\-]+):([^\/]{2})/i.test(url)||/^\s*#/.test(url)){self.source=url;return;}
var isProtocolRelative=url.indexOf('//')===0;if(url.indexOf('/')===0&&!isProtocolRelative){url=(baseUri?baseUri.protocol||'http':'http')+'://mce_host'+url;}
if(!/^[\w\-]*:?\/\//.test(url)){base_url=settings.base_uri?settings.base_uri.path:new URI(location.href).directory;if(settings.base_uri.protocol===""){url='//mce_host'+self.toAbsPath(base_url,url);}else{url=/([^#?]*)([#?]?.*)/.exec(url);url=((baseUri&&baseUri.protocol)||'http')+'://mce_host'+self.toAbsPath(base_url,url[1])+url[2];}}
url=url.replace(/@@/g,'(mce_at)');url=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(url);each(queryParts,function(v,i){var part=url[i];if(part){part=part.replace(/\(mce_at\)/g,'@@');}
self[v]=part;});if(baseUri){if(!self.protocol){self.protocol=baseUri.protocol;}
if(!self.userInfo){self.userInfo=baseUri.userInfo;}
if(!self.port&&self.host==='mce_host'){self.port=baseUri.port;}
if(!self.host||self.host==='mce_host'){self.host=baseUri.host;}
self.source='';}
if(isProtocolRelative){self.protocol='';}}
URI.prototype={setPath:function(path){var self=this;path=/^(.*?)\/?(\w+)?$/.exec(path);self.path=path[0];self.directory=path[1];self.file=path[2];self.source='';self.getURI();},toRelative:function(uri){var self=this,output;if(uri==="./"){return uri;}
uri=new URI(uri,{base_uri:self});if((uri.host!='mce_host'&&self.host!=uri.host&&uri.host)||self.port!=uri.port||(self.protocol!=uri.protocol&&uri.protocol!=="")){return uri.getURI();}
var tu=self.getURI(),uu=uri.getURI();if(tu==uu||(tu.charAt(tu.length-1)=="/"&&tu.substr(0,tu.length-1)==uu)){return tu;}
output=self.toRelPath(self.path,uri.path);if(uri.query){output+='?'+uri.query;}
if(uri.anchor){output+='#'+uri.anchor;}
return output;},toAbsolute:function(uri,noHost){uri=new URI(uri,{base_uri:this});return uri.getURI(noHost&&this.isSameOrigin(uri));},isSameOrigin:function(uri){if(this.host==uri.host&&this.protocol==uri.protocol){if(this.port==uri.port){return true;}
var defaultPort=DEFAULT_PORTS[this.protocol];if(defaultPort&&((this.port||defaultPort)==(uri.port||defaultPort))){return true;}}
return false;},toRelPath:function(base,path){var items,breakPoint=0,out='',i,l;base=base.substring(0,base.lastIndexOf('/'));base=base.split('/');items=path.split('/');if(base.length>=items.length){for(i=0,l=base.length;i<l;i++){if(i>=items.length||base[i]!=items[i]){breakPoint=i+1;break;}}}
if(base.length<items.length){for(i=0,l=items.length;i<l;i++){if(i>=base.length||base[i]!=items[i]){breakPoint=i+1;break;}}}
if(breakPoint===1){return path;}
for(i=0,l=base.length-(breakPoint-1);i<l;i++){out+="../";}
for(i=breakPoint-1,l=items.length;i<l;i++){if(i!=breakPoint-1){out+="/"+items[i];}else{out+=items[i];}}
return out;},toAbsPath:function(base,path){var i,nb=0,o=[],tr,outPath;tr=/\/$/.test(path)?'/':'';base=base.split('/');path=path.split('/');each(base,function(k){if(k){o.push(k);}});base=o;for(i=path.length-1,o=[];i>=0;i--){if(path[i].length===0||path[i]==="."){continue;}
if(path[i]==='..'){nb++;continue;}
if(nb>0){nb--;continue;}
o.push(path[i]);}
i=base.length-nb;if(i<=0){outPath=o.reverse().join('/');}else{outPath=base.slice(0,i).join('/')+'/'+o.reverse().join('/');}
if(outPath.indexOf('/')!==0){outPath='/'+outPath;}
if(tr&&outPath.lastIndexOf('/')!==outPath.length-1){outPath+=tr;}
return outPath;},getURI:function(noProtoHost){var s,self=this;if(!self.source||noProtoHost){s='';if(!noProtoHost){if(self.protocol){s+=self.protocol+'://';}else{s+='//';}
if(self.userInfo){s+=self.userInfo+'@';}
if(self.host){s+=self.host;}
if(self.port){s+=':'+self.port;}}
if(self.path){s+=self.path;}
if(self.query){s+='?'+self.query;}
if(self.anchor){s+='#'+self.anchor;}
self.source=s;}
return self.source;}};return URI;});