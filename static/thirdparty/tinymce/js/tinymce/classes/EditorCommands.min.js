
define("tinymce/EditorCommands",["tinymce/html/Serializer","tinymce/Env","tinymce/util/Tools","tinymce/dom/ElementUtils","tinymce/dom/RangeUtils","tinymce/dom/TreeWalker"],function(Serializer,Env,Tools,ElementUtils,RangeUtils,TreeWalker){var each=Tools.each,extend=Tools.extend;var map=Tools.map,inArray=Tools.inArray,explode=Tools.explode;var isGecko=Env.gecko,isIE=Env.ie,isOldIE=Env.ie&&Env.ie<11;var TRUE=true,FALSE=false;return function(editor){var dom=editor.dom,selection=editor.selection,commands={state:{},exec:{},value:{}},settings=editor.settings,formatter=editor.formatter,bookmark;function execCommand(command,ui,value){var func;command=command.toLowerCase();if((func=commands.exec[command])){func(command,ui,value);return TRUE;}
return FALSE;}
function queryCommandState(command){var func;command=command.toLowerCase();if((func=commands.state[command])){return func(command);}
return-1;}
function queryCommandValue(command){var func;command=command.toLowerCase();if((func=commands.value[command])){return func(command);}
return FALSE;}
function addCommands(command_list,type){type=type||'exec';each(command_list,function(callback,command){each(command.toLowerCase().split(','),function(command){commands[type][command]=callback;});});}
extend(this,{execCommand:execCommand,queryCommandState:queryCommandState,queryCommandValue:queryCommandValue,addCommands:addCommands});function execNativeCommand(command,ui,value){if(ui===undefined){ui=FALSE;}
if(value===undefined){value=null;}
return editor.getDoc().execCommand(command,ui,value);}
function isFormatMatch(name){return formatter.match(name);}
function toggleFormat(name,value){formatter.toggle(name,value?{value:value}:undefined);editor.nodeChanged();}
function storeSelection(type){bookmark=selection.getBookmark(type);}
function restoreSelection(){selection.moveToBookmark(bookmark);}
addCommands({'mceResetDesignMode,mceBeginUndoLevel':function(){},'mceEndUndoLevel,mceAddUndoLevel':function(){editor.undoManager.add();},'Cut,Copy,Paste':function(command){var doc=editor.getDoc(),failed;try{execNativeCommand(command);}catch(ex){failed=TRUE;}
if(failed||!doc.queryCommandSupported(command)){var msg=editor.translate("Your browser doesn't support direct access to the clipboard. "+"Please use the Ctrl+X/C/V keyboard shortcuts instead.");if(Env.mac){msg=msg.replace(/Ctrl\+/g,'\u2318+');}
editor.windowManager.alert(msg);}},unlink:function(){if(selection.isCollapsed()){var elm=selection.getNode();if(elm.tagName=='A'){editor.dom.remove(elm,true);}
return;}
formatter.remove("link");},'JustifyLeft,JustifyCenter,JustifyRight,JustifyFull':function(command){var align=command.substring(7);if(align=='full'){align='justify';}
each('left,center,right,justify'.split(','),function(name){if(align!=name){formatter.remove('align'+name);}});toggleFormat('align'+align);execCommand('mceRepaint');},'InsertUnorderedList,InsertOrderedList':function(command){var listElm,listParent;execNativeCommand(command);listElm=dom.getParent(selection.getNode(),'ol,ul');if(listElm){listParent=listElm.parentNode;if(/^(H[1-6]|P|ADDRESS|PRE)$/.test(listParent.nodeName)){storeSelection();dom.split(listParent,listElm);restoreSelection();}}},'Bold,Italic,Underline,Strikethrough,Superscript,Subscript':function(command){toggleFormat(command);},'ForeColor,HiliteColor,FontName':function(command,ui,value){toggleFormat(command,value);},FontSize:function(command,ui,value){var fontClasses,fontSizes;if(value>=1&&value<=7){fontSizes=explode(settings.font_size_style_values);fontClasses=explode(settings.font_size_classes);if(fontClasses){value=fontClasses[value-1]||value;}else{value=fontSizes[value-1]||value;}}
toggleFormat(command,value);},RemoveFormat:function(command){formatter.remove(command);},mceBlockQuote:function(){toggleFormat('blockquote');},FormatBlock:function(command,ui,value){return toggleFormat(value||'p');},mceCleanup:function(){var bookmark=selection.getBookmark();editor.setContent(editor.getContent({cleanup:TRUE}),{cleanup:TRUE});selection.moveToBookmark(bookmark);},mceRemoveNode:function(command,ui,value){var node=value||selection.getNode();if(node!=editor.getBody()){storeSelection();editor.dom.remove(node,TRUE);restoreSelection();}},mceSelectNodeDepth:function(command,ui,value){var counter=0;dom.getParent(selection.getNode(),function(node){if(node.nodeType==1&&counter++==value){selection.select(node);return FALSE;}},editor.getBody());},mceSelectNode:function(command,ui,value){selection.select(value);},mceInsertContent:function(command,ui,value){var parser,serializer,parentNode,rootNode,fragment,args;var marker,rng,node,node2,bookmarkHtml,merge;var textInlineElements=editor.schema.getTextInlineElements();function trimOrPaddLeftRight(html){var rng,container,offset;rng=selection.getRng(true);container=rng.startContainer;offset=rng.startOffset;function hasSiblingText(siblingName){return container[siblingName]&&container[siblingName].nodeType==3;}
if(container.nodeType==3){if(offset>0){html=html.replace(/^&nbsp;/,' ');}else if(!hasSiblingText('previousSibling')){html=html.replace(/^ /,'&nbsp;');}
if(offset<container.length){html=html.replace(/&nbsp;(<br>|)$/,' ');}else if(!hasSiblingText('nextSibling')){html=html.replace(/(&nbsp;| )(<br>|)$/,'&nbsp;');}}
return html;}
function markInlineFormatElements(fragment){if(merge){for(node=fragment.firstChild;node;node=node.walk(true)){if(textInlineElements[node.name]){node.attr('data-mce-new',"true");}}}}
function reduceInlineTextElements(){if(merge){var root=editor.getBody(),elementUtils=new ElementUtils(dom);each(dom.select('*[data-mce-new]'),function(node){node.removeAttribute('data-mce-new');for(var testNode=node.parentNode;testNode&&testNode!=root;testNode=testNode.parentNode){if(elementUtils.compare(testNode,node)){dom.remove(node,true);}}});}}
if(typeof(value)!='string'){merge=value.merge;value=value.content;}
if(/^ | $/.test(value)){value=trimOrPaddLeftRight(value);}
parser=editor.parser;serializer=new Serializer({},editor.schema);bookmarkHtml='<span id="mce_marker" data-mce-type="bookmark">&#xFEFF;&#x200B;</span>';args={content:value,format:'html',selection:true};editor.fire('BeforeSetContent',args);value=args.content;if(value.indexOf('{$caret}')==-1){value+='{$caret}';}
value=value.replace(/\{\$caret\}/,bookmarkHtml);rng=selection.getRng();var caretElement=rng.startContainer||(rng.parentElement?rng.parentElement():null);var body=editor.getBody();if(caretElement===body&&selection.isCollapsed()){if(dom.isBlock(body.firstChild)&&dom.isEmpty(body.firstChild)){rng=dom.createRng();rng.setStart(body.firstChild,0);rng.setEnd(body.firstChild,0);selection.setRng(rng);}}
if(!selection.isCollapsed()){editor.getDoc().execCommand('Delete',false,null);}
parentNode=selection.getNode();var parserArgs={context:parentNode.nodeName.toLowerCase()};fragment=parser.parse(value,parserArgs);markInlineFormatElements(fragment);node=fragment.lastChild;if(node.attr('id')=='mce_marker'){marker=node;for(node=node.prev;node;node=node.walk(true)){if(node.type==3||!dom.isBlock(node.name)){if(editor.schema.isValidChild(node.parent.name,'span')){node.parent.insert(marker,node,node.name==='br');}
break;}}}
if(!parserArgs.invalid){value=serializer.serialize(fragment);node=parentNode.firstChild;node2=parentNode.lastChild;if(!node||(node===node2&&node.nodeName==='BR')){dom.setHTML(parentNode,value);}else{selection.setContent(value);}}else{selection.setContent(bookmarkHtml);parentNode=selection.getNode();rootNode=editor.getBody();if(parentNode.nodeType==9){parentNode=node=rootNode;}else{node=parentNode;}
while(node!==rootNode){parentNode=node;node=node.parentNode;}
value=parentNode==rootNode?rootNode.innerHTML:dom.getOuterHTML(parentNode);value=serializer.serialize(parser.parse(value.replace(/<span (id="mce_marker"|id=mce_marker).+?<\/span>/i,function(){return serializer.serialize(fragment);})));if(parentNode==rootNode){dom.setHTML(rootNode,value);}else{dom.setOuterHTML(parentNode,value);}}
reduceInlineTextElements();marker=dom.get('mce_marker');selection.scrollIntoView(marker);rng=dom.createRng();node=marker.previousSibling;if(node&&node.nodeType==3){rng.setStart(node,node.nodeValue.length);if(!isIE){node2=marker.nextSibling;if(node2&&node2.nodeType==3){node.appendData(node2.data);node2.parentNode.removeChild(node2);}}}else{rng.setStartBefore(marker);rng.setEndBefore(marker);}
dom.remove(marker);selection.setRng(rng);editor.fire('SetContent',args);editor.addVisual();},mceInsertRawHTML:function(command,ui,value){selection.setContent('tiny_mce_marker');editor.setContent(editor.getContent().replace(/tiny_mce_marker/g,function(){return value;}));},mceToggleFormat:function(command,ui,value){toggleFormat(value);},mceSetContent:function(command,ui,value){editor.setContent(value);},'Indent,Outdent':function(command){var intentValue,indentUnit,value;intentValue=settings.indentation;indentUnit=/[a-z%]+$/i.exec(intentValue);intentValue=parseInt(intentValue,10);if(!queryCommandState('InsertUnorderedList')&&!queryCommandState('InsertOrderedList')){if(!settings.forced_root_block&&!dom.getParent(selection.getNode(),dom.isBlock)){formatter.apply('div');}
each(selection.getSelectedBlocks(),function(element){if(element.nodeName!="LI"){var indentStyleName=editor.getParam('indent_use_margin',false)?'margin':'padding';indentStyleName+=dom.getStyle(element,'direction',true)=='rtl'?'Right':'Left';if(command=='outdent'){value=Math.max(0,parseInt(element.style[indentStyleName]||0,10)-intentValue);dom.setStyle(element,indentStyleName,value?value+indentUnit:'');}else{value=(parseInt(element.style[indentStyleName]||0,10)+intentValue)+indentUnit;dom.setStyle(element,indentStyleName,value);}}});}else{execNativeCommand(command);}},mceRepaint:function(){if(isGecko){try{storeSelection(TRUE);if(selection.getSel()){selection.getSel().selectAllChildren(editor.getBody());}
selection.collapse(TRUE);restoreSelection();}catch(ex){}}},InsertHorizontalRule:function(){editor.execCommand('mceInsertContent',false,'<hr />');},mceToggleVisualAid:function(){editor.hasVisual=!editor.hasVisual;editor.addVisual();},mceReplaceContent:function(command,ui,value){editor.execCommand('mceInsertContent',false,value.replace(/\{\$selection\}/g,selection.getContent({format:'text'})));},mceInsertLink:function(command,ui,value){var anchor;if(typeof(value)=='string'){value={href:value};}
anchor=dom.getParent(selection.getNode(),'a');value.href=value.href.replace(' ','%20');if(!anchor||!value.href){formatter.remove('link');}
if(value.href){formatter.apply('link',value,anchor);}},selectAll:function(){var root=dom.getRoot(),rng;if(selection.getRng().setStart){rng=dom.createRng();rng.setStart(root,0);rng.setEnd(root,root.childNodes.length);selection.setRng(rng);}else{rng=selection.getRng();if(!rng.item){rng.moveToElementText(root);rng.select();}}},"delete":function(){execNativeCommand("Delete");var body=editor.getBody();if(dom.isEmpty(body)){editor.setContent('');if(body.firstChild&&dom.isBlock(body.firstChild)){editor.selection.setCursorLocation(body.firstChild,0);}else{editor.selection.setCursorLocation(body,0);}}},mceNewDocument:function(){editor.setContent('');},InsertLineBreak:function(command,ui,value){var evt=value;var brElm,extraBr,marker;var rng=selection.getRng(true);new RangeUtils(dom).normalize(rng);var offset=rng.startOffset;var container=rng.startContainer;if(container.nodeType==1&&container.hasChildNodes()){var isAfterLastNodeInContainer=offset>container.childNodes.length-1;container=container.childNodes[Math.min(offset,container.childNodes.length-1)]||container;if(isAfterLastNodeInContainer&&container.nodeType==3){offset=container.nodeValue.length;}else{offset=0;}}
var parentBlock=dom.getParent(container,dom.isBlock);var parentBlockName=parentBlock?parentBlock.nodeName.toUpperCase():'';var containerBlock=parentBlock?dom.getParent(parentBlock.parentNode,dom.isBlock):null;var containerBlockName=containerBlock?containerBlock.nodeName.toUpperCase():'';var isControlKey=evt&&evt.ctrlKey;if(containerBlockName=='LI'&&!isControlKey){parentBlock=containerBlock;parentBlockName=containerBlockName;}
function hasRightSideContent(){var walker=new TreeWalker(container,parentBlock),node;var nonEmptyElementsMap=editor.schema.getNonEmptyElements();while((node=walker.next())){if(nonEmptyElementsMap[node.nodeName.toLowerCase()]||node.length>0){return true;}}}
if(container&&container.nodeType==3&&offset>=container.nodeValue.length){if(!isOldIE&&!hasRightSideContent()){brElm=dom.create('br');rng.insertNode(brElm);rng.setStartAfter(brElm);rng.setEndAfter(brElm);extraBr=true;}}
brElm=dom.create('br');rng.insertNode(brElm);var documentMode=dom.doc.documentMode;if(isOldIE&&parentBlockName=='PRE'&&(!documentMode||documentMode<8)){brElm.parentNode.insertBefore(dom.doc.createTextNode('\r'),brElm);}
marker=dom.create('span',{},'&nbsp;');brElm.parentNode.insertBefore(marker,brElm);selection.scrollIntoView(marker);dom.remove(marker);if(!extraBr){rng.setStartAfter(brElm);rng.setEndAfter(brElm);}else{rng.setStartBefore(brElm);rng.setEndBefore(brElm);}
selection.setRng(rng);editor.undoManager.add();return TRUE;}});addCommands({'JustifyLeft,JustifyCenter,JustifyRight,JustifyFull':function(command){var name='align'+command.substring(7);var nodes=selection.isCollapsed()?[dom.getParent(selection.getNode(),dom.isBlock)]:selection.getSelectedBlocks();var matches=map(nodes,function(node){return!!formatter.matchNode(node,name);});return inArray(matches,TRUE)!==-1;},'Bold,Italic,Underline,Strikethrough,Superscript,Subscript':function(command){return isFormatMatch(command);},mceBlockQuote:function(){return isFormatMatch('blockquote');},Outdent:function(){var node;if(settings.inline_styles){if((node=dom.getParent(selection.getStart(),dom.isBlock))&&parseInt(node.style.paddingLeft,10)>0){return TRUE;}
if((node=dom.getParent(selection.getEnd(),dom.isBlock))&&parseInt(node.style.paddingLeft,10)>0){return TRUE;}}
return(queryCommandState('InsertUnorderedList')||queryCommandState('InsertOrderedList')||(!settings.inline_styles&&!!dom.getParent(selection.getNode(),'BLOCKQUOTE')));},'InsertUnorderedList,InsertOrderedList':function(command){var list=dom.getParent(selection.getNode(),'ul,ol');return list&&(command==='insertunorderedlist'&&list.tagName==='UL'||command==='insertorderedlist'&&list.tagName==='OL');}},'state');addCommands({'FontSize,FontName':function(command){var value=0,parent;if((parent=dom.getParent(selection.getNode(),'span'))){if(command=='fontsize'){value=parent.style.fontSize;}else{value=parent.style.fontFamily.replace(/, /g,',').replace(/[\'\"]/g,'').toLowerCase();}}
return value;}},'value');addCommands({Undo:function(){editor.undoManager.undo();},Redo:function(){editor.undoManager.redo();}});};});