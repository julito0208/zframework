
define("tinymce/NodeChange",["tinymce/dom/RangeUtils"],function(RangeUtils){return function(editor){var lastRng,lastPath=[];function isSameElementPath(startElm){var i,currentPath;currentPath=editor.$(startElm).parentsUntil(editor.getBody()).add(startElm);if(currentPath.length===lastPath.length){for(i=currentPath.length;i>=0;i--){if(currentPath[i]!==lastPath[i]){break;}}
if(i===-1){lastPath=currentPath;return true;}}
lastPath=currentPath;return false;}
if(!('onselectionchange'in editor.getDoc())){editor.on('NodeChange Click MouseUp KeyUp Focus',function(e){var nativeRng,fakeRng;nativeRng=editor.selection.getRng();fakeRng={startContainer:nativeRng.startContainer,startOffset:nativeRng.startOffset,endContainer:nativeRng.endContainer,endOffset:nativeRng.endOffset};if(e.type=='nodechange'||!RangeUtils.compareRanges(fakeRng,lastRng)){editor.fire('SelectionChange');}
lastRng=fakeRng;});}
editor.on('contextmenu',function(){editor.fire('SelectionChange');});editor.on('SelectionChange',function(){var startElm=editor.selection.getStart(true);if(!editor.selection.isCollapsed()&&!isSameElementPath(startElm)&&editor.dom.isChildOf(startElm,editor.getBody())){editor.nodeChanged({selectionChange:true});}});editor.on('MouseUp',function(e){if(!e.isDefaultPrevented()){editor.nodeChanged();}});this.nodeChanged=function(args){var selection=editor.selection,node,parents,root;if(editor.initialized&&!editor.settings.disable_nodechange&&!editor.settings.readonly){root=editor.getBody();node=selection.getStart()||root;node=node.ownerDocument!=editor.getDoc()?editor.getBody():node;if(node.nodeName=='IMG'&&selection.isCollapsed()){node=node.parentNode;}
parents=[];editor.dom.getParent(node,function(node){if(node===root){return true;}
parents.push(node);});args=args||{};args.element=node;args.parents=parents;editor.fire('NodeChange',args);}};};});